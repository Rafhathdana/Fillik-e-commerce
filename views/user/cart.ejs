<div class="container">
  <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
    <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
      Home
      <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
    </a>

    <span class="stext-109 cl4"> Shoping Cart </span>
  </div>
</div>

<!-- Shoping Cart -->
<form class="bg0 p-t-75 p-b-85">
  <div class="container">
    <div class="row">
      <div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
        <div class="m-l-25 m-r--38 m-lr-0-xl">
          <div class="wrap-table-shopping-cart">
            <table class="table-shopping-cart">
              <tr class="table_head">
                <th class="column-1">Product</th>
                <th class="column-2"></th>
                <th class="column-3">Price</th>
                <th class="column-4">Quantity</th>
                <th class="column-5">Total</th>
              </tr>
              <% if (cartList.length > 0) { var total=0;%> <%
              cartList.forEach(function(item) { %>

              <tr class="table_row">
                <td class="column-1">
                  <div class="how-itemcart1">
                    <img
                      src="/images/productImages/<%= item.product[0].images[0] %>"
                      alt="IMG"
                    />
                  </div>
                </td>
                <td class="column-2"><%= item.product[0].name %></td>
                <td class="column-3">
                  Rs<%= item.product[0].ourPrice/100 %><span class="slinecross">
                    Rs<%= item.product[0].orginalPrice %></span
                  >
                </td>
                <td class="column-4">
                  <div class="wrap-num-product flex-w m-l-auto m-r-0">
                    <div
                      class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m"
                    >
                      <i class="fs-16 zmdi zmdi-minus"></i>
                    </div>

                    <input
                      class="mtext-104 cl3 txt-center num-product"
                      type="number"
                      name="num-product1"
                      value="1"
                    />

                    <div
                      class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m"
                    >
                      <i class="fs-16 zmdi zmdi-plus"></i>
                    </div>
                  </div>
                </td>
                <% let sum=item.product[0].ourPrice/100 * item.quantity;
                total+=sum; let tsum=item.product[0].orginalPrice
                *item.quantity; %>
                <td class="column-5">
                  Rs<%= sum %><span class="slinecross"> Rs<%= tsum %></span>
                </td>
              </tr>

              <% }) }else{ %>
              <tr class="table_row">
                <td class="column-1">Empty Cart</td>
              </tr>

              <% } %>
            </table>
          </div>

          <div class="flex-w flex-sb-m bor15 p-t-18 p-b-15 p-lr-40 p-lr-15-sm">
            <div class="flex-w flex-m m-r-20 m-tb-5">
              <input
                class="stext-104 cl2 plh4 size-117 bor13 p-lr-20 m-r-10 m-tb-5"
                type="text"
                name="coupon"
                placeholder="Coupon Code"
              />

              <div
                class="flex-c-m stext-101 cl2 size-118 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-5"
              >
                Apply coupon
              </div>
            </div>

            <div
              class="flex-c-m stext-101 cl2 size-119 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-10"
            >
              Update Cart
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
        <div
          class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm"
        >
          <h4 class="mtext-109 cl2 p-b-30">Cart Totals</h4>

          <div class="flex-w flex-t bor12 p-b-13">
            <div class="size-208">
              <span class="stext-110 cl2"> Subtotal: </span>
            </div>

            <div class="size-209">
              <span class="mtext-110 cl2"> Rs. <%= total.toFixed(2) %> </span>
            </div>
          </div>

          <div class="flex-w flex-t bor12 p-t-15 p-b-30">
            <div class="size-208 w-full-ssm">
              <span class="stext-110 cl2"> Shipping: </span>
            </div>

            <div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
              <p class="stext-111 cl6 p-t-2">
                There are no shipping methods available. Please double check
                your address, or contact us if you need any help.
              </p>

              <div class="item-slick2 p-l-15 p-r-15 p-t-15 p-b-15">
                <!-- Block2 -->

                <a
                  href="#"
                  class="flex-c-m stext-103 cl2 size-102 bg0 bor2 hov-btn1 p-lr-15 trans-04 js-show-modal3"
                  data-product-data=""
                >
                  Add Address
                </a>
              </div>
            </div>

            <div class="p-t-15">
              <span class="stext-112 cl8"> Calculate Shipping </span>

              <div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">
                <select
                  class="js-select2"
                  name="address"
                  id="address"
                  onchange="updateInputFields()"
                >
                  <option>Select a Address ...</option>
                  <% for(let i=0;i < userAddresses.length;i++){ %>
                  <option value="<%=userAddresses[i]._id%>">
                    <%=userAddresses[i].name%>
                  </option>
                  <% } %>
                </select>
                <div class="dropDownSelect2"></div>
              </div>

              <div class="bor8 bg0 m-b-12">
                <input
                  class="stext-111 cl8 plh3 size-111 p-lr-15"
                  type="text"
                  name="userAddressesName"
                  id="userAddressesName"
                  readonly
                />
              </div>

              <div class="bor8 bg0 m-b-22">
                <input
                  class="stext-111 cl8 plh3 size-111 p-lr-15"
                  type="text"
                  name="houseName"
                  id="houseName"
                  readonly
                />
              </div>

              <div class="bor8 bg0 m-b-22">
                <input
                  class="stext-111 cl8 plh3 size-111 p-lr-15"
                  type="text"
                  name="pinCode"
                  id="pinCode"
                  readonly
                />
              </div>
              <div class="flex-w">
                <div
                  class="flex-c-m stext-101 cl2 size-115 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer"
                >
                  Update Totals
                </div>
              </div>
            </div>
          </div>

          <div class="flex-w flex-t bor12 p-t-15 p-b-30">
            <div class="size-208 w-full-ssm">
              <span class="stext-110 cl2"> Gst: </span>
            </div>
            <%let gst= (total/100*18).toFixed(2) %>
            <div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
              <p class="stext-111 cl6 p-t-2"><%= gst %></p>
            </div>
          </div>
          <div class="flex-w flex-t bor12 p-t-15 p-b-30">
            <div class="size-208 w-full-ssm">
              <span class="stext-110 cl2">Delivery: </span>
            </div>
            <%let delivery= 0 %>
            <div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
              <p class="stext-111 cl6 p-t-2"><%= delivery %></p>
            </div>
          </div>
          <div class="flex-w flex-t p-t-27 p-b-33">
            <div class="size-208">
              <span class="mtext-101 cl2"> Total: </span>
            </div>
            <% let mtotal=
            parseFloat(total)+parseFloat(gst)+parseFloat(delivery) %>
            <div class="size-209 p-t-1">
              <span class="mtext-110 cl2"> <%= mtotal %></span>
            </div>
          </div>
          <div class="item-slick2 p-l-15 p-r-15 p-t-15 p-b-15">
            <!-- Block2 -->

            <a
              href="#"
              class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 js-show-modal4"
              data-product-data=""
            >
              Proceed to Checkout
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

<!-- Product Detail -->
<!-- Related Products -->

<script>
  // Define the userAddresses object before the script is called
  var userAddresses = JSON.parse("<%= JSON.stringify(userAddresses) %>");
  console.log(userAddresses);

  function updateInputFields() {
    console.log("hello");

    // Get the selected option
    const selectElement = document.querySelector("#address");
    const selectedOption =
      selectElement.options[selectElement.selectedIndex].value;
    console.log(selectedOption);
    console.log(userAddresses);

    // Get the data for the selected option from the userAddresses object
    const selectedAddress = userAddresses.find(
      (address) => address._id === selectedOption
    );
    console.log("llo");

    // Update the input field values
    document.querySelector('[name="userAddressesName"]').value =
      selectedAddress.name;
    document.querySelector('[name="userAddressesName"]').placeholder =
      selectedAddress.name;
    document.querySelector('[name="houseName"]').value =
      selectedAddress.houseName;
    document.querySelector('[name="pinCode"]').value = selectedAddress.pinCode;
  }

  // Call the function initially to set the default values
  updateInputFields();
</script>
<%- include('address') -%> <%- include('checkOut1') -%>
